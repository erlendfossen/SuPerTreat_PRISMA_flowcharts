---
title: "Exclusion flowcharts"
output: github_document
always_allow_html: true
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
library(knitr)
knitr::opts_chunk$set(echo = TRUE) #defines default echo (display code)
knitr::opts_chunk$set(eval = TRUE) #defines default eval (display result of code)
knitr::opts_chunk$set(comment = "") # no space/character before results (e.g. in tables)
knitr::opts_chunk$set(tidy = T) # let r reformat your code to look tidy in the output
knitr::opts_chunk$set(collapse = F) # should code and results be shown in the same chunk (=T) or be split in several chunks in the document (=F)
```

The aim of this script is to make exclusion flowcharts for different clinical scenarios and outcomes. The number of patients in each group is copied from a secure server for sensitive data (not available here). Start by loading the library.

```{r libraries}
library(PRISMAstatement)
```

Next, make an exclusion flowchart for the **base clinical model with overall survival** as outcome:

```{r base clinical OS}
flow_exclusions(
    incl_counts = c(1736, 1589, 1564, 1447),
    total_label = "Total Screened",
    incl_labels = c("Curative setting", "Early disease or locoregionally advanced disease", "Outcome available"),
    excl_labels = c("Recurrence/Metastatic setting", "Metastatic disease", "Missing outcome"),
    percent_of_total = TRUE
  )

```

Similarly for the **base clinical model with disease-free survival** as outcome:

```{r base clinical dfs}
flow_exclusions(
    incl_counts = c(1736, 1589, 1564, 1251),
    total_label = "Total Screened",
    incl_labels = c("Curative setting", "Early disease or locoregionally advanced disease", "Outcome available"),
    excl_labels = c("Recurrence/Metastatic setting", "Metastatic disease", "Missing outcome"),
    percent_of_total = TRUE
  )

```

Next the flowchart for **GS1, GS2 and GS3 and overall survival**. These use the same subset of data, but GS3 has different variable encoding. 

```{r GS1 GS2 GS3 OS}
flow_exclusions(
    incl_counts = c(1736, 1267, 1230, 1206, 1097),
    total_label = "Total Screened",
    incl_labels = c("Gene expression available", "Curative setting", "Early disease or locoregionally advanced disease", "Outcome available"),
    excl_labels = c("Missing gene expression", "Recurrence/Metastatic setting", "Metastatic disease", "Missing outcome"),
    percent_of_total = TRUE
  )

```

The flowchart for **GS1, GS2 and GS3 and disease-free survival** is very similar. Note that SCANDARE is also excluded at the outcome stage due to DFS information being very low quality (same for other flowcharts). These also use the same subset of data, but GS3 has different variable encoding. 

```{r GS1 GS2 GS3 DFS}
flow_exclusions(
    incl_counts = c(1736, 1267, 1230, 1206, 907),
    total_label = "Total Screened",
    incl_labels = c("Gene expression available", "Curative setting", "Early disease or locoregionally advanced disease", "Outcome available"),
    excl_labels = c("Missing gene expression", "Recurrence/Metastatic setting", "Metastatic disease", "Missing outcome"),
    percent_of_total = TRUE
  )

```

Next the flowchart for **GS4 & GS5 and overall survival**. These use the same subset of data, but have different variable encoding for chemo agents. These are also only for Locoregionally advanced disease and require information about treatment (specifically chemotherapy agents if they had chemotherapy). 

```{r GS4 GS5 OS}
flow_exclusions(
    incl_counts = c(1736, 1267, 1044, 1012, 802, 750),
    total_label = "Total Screened",
    incl_labels = c("Gene expression available", "Locoregionally advanced disease", "Curative setting", "Treatment information available", "Outcome available"),
    excl_labels = c("Missing gene expression", "Early disease or metastatic disease", "Recurrence/Metastatic setting", "Missing treatment information", "Missing outcome"),
    percent_of_total = TRUE
  )

```


Lastly, the flowchart for **GS4 & GS5 and disease-free survival**. These use the same subset of data, but have different variable encoding for chemo agents. Very similar to OS above.  

```{r GS4 GS5 DFS}
flow_exclusions(
    incl_counts = c(1736, 1267, 1044, 1012, 802, 700),
    total_label = "Total Screened",
    incl_labels = c("Gene expression available", "Locoregionally advanced disease", "Curative setting", "Treatment information available", "Outcome available"),
    excl_labels = c("Missing gene expression", "Early disease or metastatic disease", "Recurrence/Metastatic setting", "Missing treatment information", "Missing outcome"),
    percent_of_total = TRUE
  )

```


